<?phpclass Products extends CI_Controller {	public function __construct()	{		parent::__construct();		$this->load->model('product', 'productModel');		$this->load->helper('url');	}	public function index()	{		$data['products'] = Product::getProducts();		$data['title'] = 'Products List';						$this->load->view('templates/header', $data);		$this->load->view('products/index', $data);		$this->load->view('templates/footer');	}	public function view($productSlug)	{		$data['product'] = Product::getProducts(false, $productSlug);		if ($data['product']->isEmpty())		{			show_404();		}				$data['title'] = 'Product details for: ' . $data['product']->getTitle();				$this->load->view('templates/header', $data);		$this->load->view('products/view', $data);		$this->load->view('templates/footer');	}		public function buy($productSlug)	{				$data['product'] = Product::getProducts(false, $productSlug);		if ($data['product']->isEmpty())		{			show_404();		}				$data['title'] = 'Buy product: ' . $data['product']->getTitle();				$this->load->helper('form');		$this->load->library('form_validation');				$availability = $data['product']->getAvailability();		$this->form_validation->set_rules('quantity', 'quantity', 'trim|required|less_than['.$availability.']');		$this->form_validation->set_rules('details', 'details', 'trim|required');		$this->form_validation->set_rules('email', 'e-mail', 'trim|required|valid_email');				$this->form_validation->set_message('less_than', 'You cannot purchase more than '.$availability.'.');					//since it didn't validate, the form is reloaded		if ($this->form_validation->run() === FALSE)		{			$this->load->view('templates/header', $data);				$this->load->view('products/buy', $data);			$this->load->view('templates/footer');					}		//validtion passed, purchase is being made		else		{				$orderDetails = array(				'product_id' => $data['product']->getId(), 				'buyer_email' => $this->input->post('email'), 				'buyer_details' => $this->input->post('details'),							'product_quantity' => $this->input->post('quantity'));						$this->load->model('order', 'orderModel');			$ordered = $this->orderModel->placeOrder($orderDetails);			if ($ordered) 			{								$data['title'] = 'Success!';						$this->load->view('templates/header', $data);				$this->load->view('products/success');				$this->load->view('templates/footer');			}			else			{				//TODO				//order availability error?				//reload buy page with new availability? actually new availability is "out of stock"...			}		}	}}